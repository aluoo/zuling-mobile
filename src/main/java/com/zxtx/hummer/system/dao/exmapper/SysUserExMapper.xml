<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zxtx.hummer.system.dao.exmapper.SysUserExMapper">


    <select id="get" resultType="com.zxtx.hummer.system.domain.UserDO">
        select `user_id`
             , `work_no`
             , `username`
             , `name`
             , `password`
             , `dept_id`
             , `email`
             , `mobile`
             , `status`
             , `user_id_create`
             , `gmt_create`
             , `gmt_modified`
             , `sex`
             , `birth`
             , `pic_id`
             , `live_address`
             , `hobby`
             , `province`
             , `city`
             , `district`
             , `employee_id`
             , `channel`
        from sys_user
        where user_id = #{value}
    </select>

    <select id="getUserIdByEmployeeId" resultType="long">
        select `user_id`
        from sys_user
        where employee_id = #{value}
    </select>

    <select id="lsUserFullInfo" resultType="com.zxtx.hummer.system.vo.UserFullInfVo">
        SELECT
        us.user_id,
        us.name,
        us.password,
        us.mobile,
        us.username userName,
        us.pic_id,
        us.status,
        (case when us.channel='lanhai' then '安逸出行'
        else 'other' end ) channel,
        em.id employeeId,
        em.dept_code,
        em.dept_id,
        em.company_id,
        em.mobile_number,
        em.`name` employeeName,
        em.type employeeType,
        em.status employeeStatus,
        dept.name deptName,
        company.name companyName
        FROM
        sys_user us
        LEFT JOIN employee em
        ON us.employee_id = em.id and em.`status`=1
        LEFT JOIN dept
        ON em.dept_id=dept.id and dept.status=1
        LEFT join company
        ON dept.company_id=company.id and company.status=2
        <where>
            <if test="userId != null and userId != ''">and us.user_id = #{userId}</if>
            <if test="userName != null and userName != ''">and us.username like CONCAT('%',#{userName},'%')</if>
            <if test="name != null and name != ''">and us.name like CONCAT('%',#{name},'%')</if>
            <if test="mobileNumber != null and mobileNumber != ''">and em.mobile_number like
                CONCAT(#{mobileNumber},'%')
            </if>
        </where>
        <choose>
            <when test="sort != null and sort.trim() != ''">
                order by ${sort} ${order}
            </when>
            <otherwise>
                order by user_id desc
            </otherwise>
        </choose>
        <if test="offset != null and limit != null">
            limit #{offset}, #{limit}
        </if>
    </select>


    <select id="getLoginUser" resultType="com.zxtx.hummer.system.shiro.LoginUser">
        SELECT us.user_id,
               us.name,
               us.password,
               us.username userName,
               us.pic_id,
               us.mobile,
               em.id       employeeId,
               em.dept_code,
               em.dept_id,
               em.company_id,
               em.mobile_number,
               em.`name`   employeeName,
               em.type     employeeType,
               em.status   employeeStatus,
               us.channel  channel,
               em.ancestors as employeeAncestors,
               c.name as companyName
        FROM sys_user us
                 LEFT JOIN employee em
                           ON us.employee_id = em.id and em.`status` = 1
        LEFT JOIN company c on em.company_id = c.id
        WHERE us.user_id = #{userId} LIMIT 1
    </select>


    <select id="listAllDept" resultType="long">
        select DISTINCT dept_id
        from sys_user
    </select>


    <insert id="insertEx" parameterType="com.zxtx.hummer.system.domain.SysUserDO" useGeneratedKeys="true"
            keyProperty="userId">
        insert into sys_user
        (`username`,
         `name`,
         `password`,
         `gmt_create`,
         `gmt_modified`,
         `employee_id`)
        values (#{username},
                #{name},
                #{password},
                #{gmtCreate},
                #{gmtModified},
                #{employeeId})
    </insert>

    <delete id="delByEmployeeId">
        delete
        from sys_user
        where employee_id = #{value}
    </delete>


    <update id="updateByEmployeeId" parameterType="com.zxtx.hummer.system.domain.SysUserDO">
        update sys_user
        <set>
            <if test="username != null">`username` = #{username},</if>
            <if test="name != null">`name` = #{name},</if>
            <if test="password != null">`password` = #{password},</if>
            <if test="gmtCreate != null">`gmt_create` = #{gmtCreate},</if>
            <if test="gmtModified != null">`gmt_modified` = #{gmtModified},</if>
        </set>
        where employee_id = #{employeeId}
    </update>


    <select id="list" resultType="com.zxtx.hummer.system.domain.UserDO">
        select
        `user_id`,`username`,`name`,`password`,`dept_id`,`email`,`mobile`,`status`,`user_id_create`,`gmt_create`,`gmt_modified`,`sex`,`birth`,`pic_id`,`live_address`,`hobby`,`province`,`city`,`district`
        from sys_user
        <where>
            <if test="userId != null and userId != ''">and user_id = #{userId}</if>
            <if test="username != null and username != ''">and username = #{username}</if>
            <if test="name != null and name != ''">and name = #{name}</if>
            <if test="password != null and password != ''">and password = #{password}</if>
            <if test="deptId != null and deptId != ''">and dept_id = #{deptId}</if>
            <if test="deptIds != null and deptIds.size() > 0">and dept_id in
                <foreach collection="deptIds" item="item" index="index" separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="userIds != null and userIds.size() > 0">and user_id in
                <foreach collection="userIds" item="item" index="index" separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
            <if test="email != null and email != ''">and email = #{email}</if>
            <if test="mobile != null and mobile != ''">and mobile = #{mobile}</if>
            <if test="status != null and status != ''">and status = #{status}</if>
            <if test="userIdCreate != null and userIdCreate != ''">and user_id_create = #{userIdCreate}</if>
            <if test="gmtCreate != null and gmtCreate != ''">and gmt_create = #{gmtCreate}</if>
            <if test="gmtModified != null and gmtModified != ''">and gmt_modified = #{gmtModified}</if>
            <if test="sex != null and sex != ''">and sex = #{sex}</if>
            <if test="birth != null and birth != ''">and birth = #{birth}</if>
            <if test="picId != null and picId != ''">and pic_id = #{picId}</if>
            <if test="liveAddress != null and liveAddress != ''">and live_address = #{liveAddress}</if>
            <if test="hobby != null and hobby != ''">and hobby = #{hobby}</if>
            <if test="province != null and province != ''">and province = #{province}</if>
            <if test="city != null and city != ''">and city = #{city}</if>
            <if test="district != null and district != ''">and district = #{district}</if>
        </where>
        <choose>
            <when test="sort != null and sort.trim() != ''">
                order by ${sort} ${order}
            </when>
            <otherwise>
                order by user_id desc
            </otherwise>
        </choose>
        <if test="offset != null and limit != null">
            limit #{offset}, #{limit}
        </if>
    </select>


    <select id="count" resultType="int">
        select count(*) from sys_user
        <where>
            <if test="oldUserId != null and oldUserId != ''">and user_id != #{oldUserId}</if>
            <if test="userId != null and userId != ''">and user_id = #{userId}</if>
            <if test="username != null and username != ''">and username = #{username}</if>
            <if test="name != null and name != ''">and name = #{name}</if>
            <if test="password != null and password != ''">and password = #{password}</if>
            <if test="deptId != null and deptId != ''">and dept_id = #{deptId}</if>
            <if test="email != null and email != ''">and email = #{email}</if>
            <if test="mobile != null and mobile != ''">and mobile = #{mobile}</if>
            <if test="status != null and status != ''">and status = #{status}</if>
            <if test="userIdCreate != null and userIdCreate != ''">and user_id_create = #{userIdCreate}</if>
            <if test="gmtCreate != null and gmtCreate != ''">and gmt_create = #{gmtCreate}</if>
            <if test="gmtModified != null and gmtModified != ''">and gmt_modified = #{gmtModified}</if>
            <if test="sex != null and sex != ''">and sex = #{sex}</if>
            <if test="birth != null and birth != ''">and birth = #{birth}</if>
            <if test="picId != null and picId != ''">and pic_id = #{picId}</if>
            <if test="liveAddress != null and liveAddress != ''">and live_address = #{liveAddress}</if>
            <if test="hobby != null and hobby != ''">and hobby = #{hobby}</if>
            <if test="province != null and province != ''">and province = #{province}</if>
            <if test="city != null and city != ''">and city = #{city}</if>
            <if test="district != null and district != ''">and district = #{district}</if>
        </where>
    </select>

    <insert id="save" parameterType="com.zxtx.hummer.system.domain.UserDO" useGeneratedKeys="true" keyProperty="userId">
        insert into sys_user
        (`username`,
         `work_no`,
         `name`,
         `password`,
         `dept_id`,
         `email`,
         `mobile`,
         `status`,
         `user_id_create`,
         `gmt_create`,
         `gmt_modified`,
         `sex`,
         `birth`,
         `pic_id`,
         `live_address`,
         `hobby`,
         `province`,
         `city`,
         `employee_id`,
         `district`,
         `channel`)
        values (#{username},
                #{workNo},
                #{name},
                #{password},
                #{deptId},
                #{email},
                #{mobile},
                #{status},
                #{userIdCreate},
                #{gmtCreate},
                #{gmtModified},
                #{sex},
                #{birth},
                #{picId},
                #{liveAddress},
                #{hobby},
                #{province},
                #{city},
                #{employeeId},
                #{district},
                #{channel})
    </insert>

    <update id="update" parameterType="com.zxtx.hummer.system.domain.UserDO">
        update sys_user
        <set>
            <if test="username != null">`username` = #{username},</if>
            <if test="workNo != null">`work_no` = #{workNo},</if>
            <if test="name != null">`name` = #{name},</if>
            <if test="password != null">`password` = #{password},</if>
            <if test="deptId != null">`dept_id` = #{deptId},</if>
            <if test="email != null">`email` = #{email},</if>
            <if test="mobile != null">`mobile` = #{mobile},</if>
            <if test="status != null">`status` = #{status},</if>
            <if test="userIdCreate != null">`user_id_create` = #{userIdCreate},</if>
            <if test="gmtCreate != null">`gmt_create` = #{gmtCreate},</if>
            <if test="gmtModified != null">`gmt_modified` = #{gmtModified},</if>
            <if test="sex != null">`sex` = #{sex},</if>
            <if test="birth != null">`birth` = #{birth},</if>
            <if test="picId != null">`pic_id` = #{picId},</if>
            <if test="liveAddress != null">`live_address` = #{liveAddress},</if>
            <if test="hobby != null">`hobby` = #{hobby},</if>
            <if test="province != null">`province` = #{province},</if>
            <if test="city != null">`city` = #{city},</if>
            <if test="district != null">`district` = #{district},</if>
            <if test="channel != null">`channel` = #{channel},</if>
            `employee_id` = #{employeeId},
            <if test="mobile != null">`mobile` = #{mobile}</if>

        </set>
        where user_id = #{userId}
    </update>

    <delete id="remove">
        delete
        from sys_user
        where user_id = #{value}
    </delete>

    <delete id="removeByEmployeeId">
        delete
        from sys_user
        where employee_id = #{value}
    </delete>

    <delete id="batchRemove">
        delete from sys_user where user_id in
        <foreach item="userId" collection="array" open="(" separator="," close=")">
            #{userId}
        </foreach>
    </delete>

</mapper>