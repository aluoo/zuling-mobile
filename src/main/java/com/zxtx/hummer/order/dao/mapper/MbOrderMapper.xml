<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zxtx.hummer.order.dao.mapper.MbOrderMapper">

    <select id="tranStatGroupByEmployee" resultType="com.zxtx.hummer.mobileStat.domain.RecycleDataDailyBase">
        SELECT recycler_employee_id                 as employeeId,
               count(1)                             as transNum,
               ifnull(sum(original_quote_price), 0) as transAmount
        FROM mb_order
        WHERE status in (2, 3, 4)
          and finish_quote_time between #{beginTime} and #{endTime}
        GROUP BY recycler_employee_id
    </select>

    <select id="receiptStatGroupByEmployee" resultType="com.zxtx.hummer.mobileStat.domain.RecycleDataDailyBase">
        SELECT recycler_employee_id as employeeId,
               count(1)             as orderConfirmNum
        FROM mb_order
        WHERE status = 4
          and confirm_receipt_time between #{beginTime} and #{endTime}
        GROUP BY recycler_employee_id
    </select>

    <select id="companyTransStatGroupByEmployee" resultType="com.zxtx.hummer.mobileStat.domain.CompanyDataDailyBase">
        SELECT store_employee_id as employeeId,
               count(1)          as transNum
        FROM mb_order
        WHERE status = 4
          and confirm_receipt_time between #{beginTime} and #{endTime}
        GROUP BY store_employee_id
    </select>

    <select id="companyOrderStatGroupByEmployee" resultType="com.zxtx.hummer.mobileStat.domain.CompanyDataDailyBase">
        SELECT store_employee_id as employeeId,
               count(1)          as orderNum
        FROM mb_order
        WHERE create_time between #{beginTime} and #{endTime}
        GROUP BY store_employee_id
    </select>

    <select id="priceOrderStatGroupByEmployee" resultType="com.zxtx.hummer.mobileStat.domain.CompanyDataDailyBase">
        SELECT store_employee_id           as employeeId,
               count(1)                    as priceNum,
               ifnull(sum(final_price), null) as finalPriceAmount
        FROM mb_order
        WHERE status in (1, 2, 3, 4)
          and finish_quote_time between #{beginTime} and #{endTime}
        GROUP BY store_employee_id
    </select>

    <select id="cancelStatGroupByEmployee" resultType="com.zxtx.hummer.mobileStat.domain.CompanyDataDailyBase">
        SELECT store_employee_id AS employeeId,
               count(1)          as cancelNum
        from mb_order a
                 INNER JOIN mb_order_log b on a.id = b.order_id
        where a.status = -1
          and b.status = 9
          AND b.create_time between #{beginTime} and #{endTime}
        GROUP BY store_employee_id
    </select>

    <select id="overTimeStatGroupByEmployee" resultType="com.zxtx.hummer.mobileStat.domain.CompanyDataDailyBase">
        SELECT store_employee_id AS employeeId,
               count(1)          as overtimeNum
        from mb_order a
                 INNER JOIN mb_order_log b on a.id = b.order_id
        where a.status = -1
          and b.status = 10
          AND b.create_time between #{beginTime} and #{endTime}
        GROUP BY store_employee_id
    </select>

    <select id="refundGroupByEmployee" resultType="com.zxtx.hummer.mobileStat.domain.RecycleDataDailyBase">
        SELECT a.recycler_employee_id as employeeId,
               ifnull(sum(b.amount), 0) as refundAmount
        FROM mb_order a
            left join mb_order_customer_refund_payment b on a.id = b.order_id
        WHERE a.status = -2
          and b.pay_time between #{beginTime} and #{endTime}
        GROUP BY a.recycler_employee_id
    </select>

</mapper>
